<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>éº»ç¥ç†å·¥æ¯”èµ›ç§¯åˆ†ç®¡ç†ç³»ç»Ÿ</title>
    <meta name="description" content="ä¸“ä¸šçš„éº»å°†æ¯”èµ›ç®¡ç†ä¸æ’åç³»ç»Ÿï¼Œæ”¯æŒ4-8äººæ¯”èµ›ï¼Œå®æ—¶æ’åç»Ÿè®¡">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ä¼˜åŒ–ç§»åŠ¨ç«¯padding */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 15px;
                box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            }
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ffa500);
            color: white;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        @media (max-width: 768px) {
            .header {
                padding: 25px 20px;
            }
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translate(-50%, -50%) rotate(0deg); }
            50% { transform: translate(-50%, -50%) rotate(180deg); }
        }

        .header h1 {
            font-size: 2.8em;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .header p {
                font-size: 0.95em;
            }
        }

        .nav {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .nav::-webkit-scrollbar {
            display: none;
        }

        .nav-btn {
            flex: 1;
            min-width: 120px;
            padding: 18px 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            color: #495057;
            white-space: nowrap;
            touch-action: manipulation;
        }

        @media (max-width: 768px) {
            .nav-btn {
                padding: 15px 10px;
                font-size: 14px;
                min-width: 100px;
            }
        }

        .nav-btn:hover, .nav-btn:active {
            background: #007bff;
            color: white;
            transform: translateY(-2px);
        }

        @media (hover: none) {
            .nav-btn:hover {
                transform: none;
            }
        }

        .nav-btn.active {
            background: #007bff;
            color: white;
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }

        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid white;
        }

        @media (max-width: 768px) {
            .nav-btn.active::after {
                display: none;
            }
        }

        .content {
            padding: 40px;
            min-height: 500px;
            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
        }

        @media (max-width: 768px) {
            .content {
                padding: 20px;
                min-height: 400px;
            }
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section h2 {
            font-size: 2.2em;
            color: #2c3e50;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
        }

        @media (max-width: 768px) {
            .section h2 {
                font-size: 1.6em;
                margin-bottom: 20px;
            }
        }

        .section h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        @media (max-width: 768px) {
            .form-group {
                margin-bottom: 20px;
            }
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
            font-size: 1.1em;
        }

        @media (max-width: 768px) {
            .form-group label {
                font-size: 1em;
                margin-bottom: 8px;
            }
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            -webkit-appearance: none;
            appearance: none;
        }

        @media (max-width: 768px) {
            .form-group input, .form-group select {
                padding: 12px;
                font-size: 16px; /* é˜²æ­¢iOSè‡ªåŠ¨ç¼©æ”¾ */
            }
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
            transform: translateY(-2px);
        }

        @media (hover: none) {
            .form-group input:focus, .form-group select:focus {
                transform: none;
            }
        }

        .btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 8px;
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
            min-height: 48px; /* ç¡®ä¿ç§»åŠ¨ç«¯æ˜“äºç‚¹å‡» */
        }

        @media (max-width: 768px) {
            .btn {
                padding: 12px 24px;
                font-size: 15px;
                margin: 5px;
            }
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transition: all 0.6s ease;
            transform: translate(-50%, -50%);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover, .btn:active {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        @media (hover: none) {
            .btn:hover {
                transform: none;
            }
        }

        .btn:active {
            transform: translateY(-1px);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .participant-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .participant-list {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-top: 20px;
            }
        }

        .participant-card {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            padding: 25px;
            border-radius: 18px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        @media (max-width: 768px) {
            .participant-card {
                padding: 20px;
                border-radius: 15px;
            }
        }

        .participant-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.6s ease;
        }

        .participant-card:hover::before {
            left: 100%;
        }

        .participant-card:hover {
            border-color: #007bff;
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        @media (hover: none) {
            .participant-card:hover {
                transform: none;
            }
        }

        .participant-card h4 {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .participant-card h4 {
                font-size: 1.2em;
            }
        }

        .participant-card p {
            color: #6c757d;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .game-form {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 35px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 2px solid #dee2e6;
        }

        @media (max-width: 768px) {
            .game-form {
                padding: 20px;
                border-radius: 15px;
                margin-bottom: 20px;
            }
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        @media (max-width: 768px) {
            .players-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                margin: 20px 0;
            }
        }

        .player-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        @media (max-width: 768px) {
            .player-controls {
                gap: 10px;
                margin: 15px 0;
            }
        }

        .player-count-badge {
            background: linear-gradient(135deg, #6f42c1, #e83e8c);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 1.1em;
            display: inline-block;
            margin-bottom: 15px;
        }

        @media (max-width: 768px) {
            .player-count-badge {
                font-size: 1em;
                padding: 6px 16px;
            }
        }

        .game-history {
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .game-history {
                margin-top: 20px;
            }
        }

        .game-record {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 2px solid #dee2e6;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        @media (max-width: 768px) {
            .game-record {
                padding: 20px;
                margin-bottom: 15px;
            }
        }

        .game-record:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        @media (hover: none) {
            .game-record:hover {
                transform: none;
            }
        }

        .game-record h4 {
            color: #007bff;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        @media (max-width: 768px) {
            .game-record h4 {
                font-size: 1.1em;
                margin-bottom: 12px;
            }
        }

        .game-record p {
            font-size: 1.1em;
            color: #495057;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .game-record p {
                font-size: 0.95em;
                margin-bottom: 12px;
            }
        }

        /* ä¼˜åŒ–è¡¨æ ¼å“åº”å¼æ˜¾ç¤º */
        .table-wrapper {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 25px;
        }

        .ranking-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            min-width: 600px;
        }

        @media (max-width: 768px) {
            .ranking-table {
                min-width: 500px;
                font-size: 0.9em;
            }
        }

        .ranking-table th, .ranking-table td {
            padding: 18px 15px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        @media (max-width: 768px) {
            .ranking-table th, .ranking-table td {
                padding: 12px 10px;
            }
        }

        .ranking-table th {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            font-weight: 600;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        @media (max-width: 768px) {
            .ranking-table th {
                font-size: 0.9em;
            }
        }

        .ranking-table tr:hover {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
        }

        .rank-1 { color: #ffd700; font-weight: bold; font-size: 1.2em; }
        .rank-2 { color: #c0c0c0; font-weight: bold; font-size: 1.1em; }
        .rank-3 { color: #cd7f32; font-weight: bold; font-size: 1.1em; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
                margin: 20px 0;
            }
        }

        .stats-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        @media (max-width: 768px) {
            .stats-card {
                padding: 25px;
                border-radius: 15px;
            }
        }

        .stats-card:hover {
            transform: translateY(-5px);
        }

        @media (hover: none) {
            .stats-card:hover {
                transform: none;
            }
        }

        .stats-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        .stats-card h3 {
            font-size: 2.5em;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .stats-card h3 {
                font-size: 2em;
            }
        }

        .stats-card p {
            font-size: 1.2em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .stats-card p {
                font-size: 1em;
            }
        }

        .alert {
            padding: 18px 25px;
            margin: 20px 0;
            border-radius: 12px;
            font-weight: 500;
            font-size: 1.1em;
            border: none;
            position: relative;
            overflow: hidden;
        }

        @media (max-width: 768px) {
            .alert {
                padding: 15px 20px;
                font-size: 1em;
                margin: 15px 0;
            }
        }

        .alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: currentColor;
        }

        .alert-success {
            background: linear-gradient(145deg, #d4edda, #c3e6cb);
            color: #155724;
        }

        .alert-error {
            background: linear-gradient(145deg, #f8d7da, #f5c6cb);
            color: #721c24;
        }

        .password-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            padding: 20px;
        }

        .password-dialog {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            min-width: 350px;
            max-width: 90%;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        @media (max-width: 768px) {
            .password-dialog {
                padding: 30px 20px;
                min-width: auto;
                width: 100%;
                max-width: 350px;
            }
        }

        .password-modal[style*="flex"] .password-dialog {
            transform: scale(1);
        }

        .password-dialog h3 {
            margin-bottom: 25px;
            color: #2c3e50;
            font-size: 1.6em;
        }

        @media (max-width: 768px) {
            .password-dialog h3 {
                font-size: 1.3em;
                margin-bottom: 20px;
            }
        }

        .password-dialog input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 18px;
            margin-bottom: 25px;
            text-align: center;
            letter-spacing: 2px;
        }

        @media (max-width: 768px) {
            .password-dialog input {
                padding: 12px;
                font-size: 16px;
                margin-bottom: 20px;
            }
        }

        .password-dialog .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        @media (max-width: 768px) {
            .password-dialog .btn-group {
                gap: 10px;
            }
        }

        .password-dialog .btn {
            flex: 1;
            max-width: 120px;
        }

        /* å¹³æ¿ä¼˜åŒ– (iPadç­‰) */
        @media (min-width: 769px) and (max-width: 1024px) {
            .container {
                max-width: 95%;
            }

            .players-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .participant-list {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½ */
        .nav, .table-wrapper {
            -webkit-overflow-scrolling: touch;
            will-change: scroll-position;
        }

        /* é˜²æ­¢åŒå‡»ç¼©æ”¾ */
        button, input, select, textarea {
            touch-action: manipulation;
        }

        /* ä¼˜åŒ–è¾“å…¥æ¡†èšç„¦æ—¶çš„è§†å£é—®é¢˜ */
        @media (max-width: 768px) {
            input:focus, select:focus, textarea:focus {
                font-size: 16px !important;
            }
        }

        /* æ¨ªå‘æ»šåŠ¨æç¤º */
        .table-wrapper::after {
            content: 'â† å·¦å³æ»‘åŠ¨æŸ¥çœ‹æ›´å¤š â†’';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            color: #6c757d;
            opacity: 0.8;
            white-space: nowrap;
        }

        @media (min-width: 769px) {
            .table-wrapper::after {
                display: none;
            }
        }

        /* é’ˆå¯¹å°å±æ‰‹æœºçš„ç‰¹æ®Šä¼˜åŒ– */
        @media (max-width: 375px) {
            .header h1 {
                font-size: 1.5em;
            }

            .nav-btn {
                min-width: 85px;
                font-size: 13px;
                padding: 12px 8px;
            }

            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }

            .section h2 {
                font-size: 1.4em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ€„ éº»ç¥ç†å·¥æ¯”èµ›ç§¯åˆ†ç®¡ç†ç³»ç»Ÿ</h1>
            <p>ä¸“ä¸šçš„éº»å°†æ¯”èµ›ç®¡ç†ä¸å®æ—¶æ’åç»Ÿè®¡å¹³å°</p>
        </div>

        <nav class="nav">
            <button class="nav-btn active" onclick="showSection('participants')">
                ğŸ‘¥ å‚ä¸è€…ç®¡ç†
            </button>
            <button class="nav-btn" onclick="showSection('game')">
                ğŸ® å½•å…¥æ¯”èµ›
            </button>
            <button class="nav-btn" onclick="showSection('ranking')">
                ğŸ† å®æ—¶æ’å
            </button>
            <button class="nav-btn" onclick="showSection('history')">
                ğŸ“Š å†å²è®°å½•
            </button>
        </nav>

        <main class="content">
            <!-- å‚ä¸è€…ç®¡ç† -->
            <section id="participants" class="section active">
                <h2>å‚ä¸è€…ç®¡ç†</h2>
                <div class="form-group">
                    <label for="playerName">
                        <i>ğŸ“</i> æ·»åŠ æ–°å‚ä¸è€…
                    </label>
                    <input type="text" id="playerName" placeholder="è¯·è¾“å…¥å‚ä¸è€…å§“å" maxlength="20">
                </div>
                <button class="btn" onclick="addParticipant()">
                    â• æ·»åŠ å‚ä¸è€…
                </button>
                <div id="participantsList" class="participant-list"></div>
            </section>

            <!-- å½•å…¥æ¯”èµ› -->
            <section id="game" class="section">
                <h2>å½•å…¥æ¯”èµ›ç»“æœ</h2>
                <div class="game-form">
                    <div class="form-group">
                        <label for="gameDate">
                            ğŸ“… æ¯”èµ›æ—¥æœŸ
                        </label>
                        <input type="date" id="gameDate">
                    </div>
                    
                    <div class="form-group">
                        <label>
                            ğŸ‘¥ å‚ä¸äººæ•°è®¾ç½®
                        </label>
                        <div class="player-count-badge">
                            å½“å‰å‚ä¸äººæ•°: <span id="playerCount">4</span> äºº
                        </div>
                        <div class="player-controls">
                            <button type="button" class="btn" onclick="addGamePlayer()">
                                â• æ·»åŠ ç©å®¶
                            </button>
                            <button type="button" class="btn btn-danger" onclick="removeGamePlayer()">
                                â– ç§»é™¤ç©å®¶
                            </button>
                        </div>
                    </div>
                    
                    <div id="playersContainer" class="players-grid">
                        <!-- åŠ¨æ€ç”Ÿæˆçš„ç©å®¶é€‰æ‹©æ¡† -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 30px;">
                        <button class="btn" onclick="recordGame()" style="font-size: 1.2em; padding: 18px 40px;">
                            ğŸ¯ è®°å½•æ¯”èµ›ç»“æœ
                        </button>
                    </div>
                </div>
            </section>

            <!-- å®æ—¶æ’å -->
            <section id="ranking" class="section">
                <h2>å®æ—¶æ’åç»Ÿè®¡</h2>
                <div class="form-group">
                    <label for="yearFilter">
                        ğŸ“ˆ ç­›é€‰å¹´ä»½
                    </label>
                    <select id="yearFilter" onchange="updateRanking()">
                        <option value="all">ğŸ“Š å…¨éƒ¨å¹´ä»½ç»Ÿè®¡</option>
                    </select>
                </div>
                
                <div class="stats-grid">
                    <div class="stats-card">
                        <h3 id="totalGames">0</h3>
                        <p>ğŸ® æ€»æ¯”èµ›åœºæ¬¡</p>
                    </div>
                    <div class="stats-card">
                        <h3 id="totalParticipants">0</h3>
                        <p>ğŸ‘¥ å‚ä¸æ€»äººæ•°</p>
                    </div>
                </div>
                
                <div class="table-wrapper">
                    <table id="rankingTable" class="ranking-table">
                        <thead>
                            <tr>
                                <th>ğŸ† æ’å</th>
                                <th>ğŸ‘¤ å§“å</th>
                                <th>ğŸ“Š æ€»ç§¯åˆ†</th>
                                <th>ğŸ¯ å‚èµ›æ¬¡æ•°</th>
                                <th>ğŸ–ï¸ èƒœç‡</th>
                                <th>ğŸ“ˆ å¹³å‡åˆ†</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>

            <!-- å†å²è®°å½• -->
            <section id="history" class="section">
                <h2>æ¯”èµ›å†å²è®°å½•</h2>
                <div style="text-align: center; margin-bottom: 30px;">
                    <button class="btn" onclick="exportData()">
                        ğŸ“¤ å¯¼å‡ºæ•°æ®å¤‡ä»½
                    </button>
                    <button class="btn" onclick="document.getElementById('importFile').click()">
                        ğŸ“¥ å¯¼å…¥æ•°æ®å¤‡ä»½
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                    <button class="btn btn-danger" id="clearAllBtn">
                        ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®
                    </button>
                </div>
                <div id="gameHistory" class="game-history"></div>
            </section>
        </main>
    </div>

    <!-- å¯†ç éªŒè¯å¼¹çª— -->
    <div id="passwordModal" class="password-modal">
        <div class="password-dialog">
            <h3>ğŸ” ç®¡ç†å‘˜èº«ä»½éªŒè¯</h3>
            <input type="password" id="passwordInput" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç " maxlength="10">
            <div class="btn-group">
                <button class="btn" onclick="confirmPassword()">âœ… ç¡®è®¤</button>
                <button class="btn btn-danger" onclick="cancelPassword()">âŒ å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- ç¡®è®¤åˆ é™¤å¼¹çª— -->
    <div id="confirmModal" class="password-modal">
        <div class="password-dialog">
            <h3 id="confirmTitle">âš ï¸ ç¡®è®¤æ“ä½œ</h3>
            <p id="confirmMessage">ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ</p>
            <div class="btn-group">
                <button class="btn" onclick="confirmDelete()">âœ… ç¡®å®š</button>
                <button class="btn btn-danger" onclick="cancelDelete()">âŒ å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        /**
         * éº»ç¥ç†å·¥æ¯”èµ›ç§¯åˆ†ç®¡ç†ç³»ç»Ÿ v2.0
         * æ”¯æŒ4-8äººéº»å°†æ¯”èµ›ï¼Œå®æ—¶æ’åç»Ÿè®¡
         * ç®¡ç†å‘˜å¯†ç : 970508
         */

        // ==================== å…¨å±€å˜é‡ ====================
        var participants = [];      // å‚ä¸è€…æ•°æ®
        var games = [];            // æ¯”èµ›è®°å½•æ•°æ®
        var pendingAction = null;  // å¾…æ‰§è¡Œçš„å¯†ç éªŒè¯æ“ä½œ
        var pendingActionData = null;
        var gamePlayerCount = 4;   // å½“å‰æ¯”èµ›å‚ä¸äººæ•°
        var confirmCallback = null; // ç¡®è®¤å¯¹è¯æ¡†å›è°ƒ
        var confirmData = null;

        // ==================== åŠ¨æ€ç©å®¶ç®¡ç† ====================
        
        /**
         * å¢åŠ æ¯”èµ›ç©å®¶æ•°é‡
         */
        function addGamePlayer() {
            if (gamePlayerCount < 8) {
                gamePlayerCount++;
                updatePlayerCount();
                generateGamePlayerInputs();
                updateGamePlayerSelects();
            } else {
                showAlert('âš ï¸ æœ€å¤šæ”¯æŒ8ä½ç©å®¶å‚ä¸æ¯”èµ›', 'error');
            }
        }

        /**
         * å‡å°‘æ¯”èµ›ç©å®¶æ•°é‡
         */
        function removeGamePlayer() {
            if (gamePlayerCount > 4) {
                gamePlayerCount--;
                updatePlayerCount();
                generateGamePlayerInputs();
                updateGamePlayerSelects();
            } else {
                showAlert('âš ï¸ è‡³å°‘éœ€è¦4ä½ç©å®¶å‚ä¸æ¯”èµ›', 'error');
            }
        }

        /**
         * æ›´æ–°æ˜¾ç¤ºçš„ç©å®¶æ•°é‡
         */
        function updatePlayerCount() {
            var countElement = document.getElementById('playerCount');
            if (countElement) {
                countElement.textContent = gamePlayerCount;
            }
        }

        /**
         * åŠ¨æ€ç”Ÿæˆç©å®¶è¾“å…¥æ¡†
         */
        function generateGamePlayerInputs() {
            var container = document.getElementById('playersContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            for (var i = 1; i <= gamePlayerCount; i++) {
                var playerDiv = document.createElement('div');
                playerDiv.className = 'form-group';
                playerDiv.innerHTML = 
                    '<label>ğŸ¯ ç©å®¶ ' + i + '</label>' +
                    '<select id="player' + i + '" aria-label="é€‰æ‹©ç©å®¶' + i + '"></select>' +
                    '<input type="number" id="score' + i + '" placeholder="è¾“å…¥ç§¯åˆ†" step="1" aria-label="ç©å®¶' + i + 'ç§¯åˆ†">';
                container.appendChild(playerDiv);
            }
        }

        /**
         * æ›´æ–°æ‰€æœ‰ç©å®¶é€‰æ‹©ä¸‹æ‹‰æ¡†
         */
        function updateGamePlayerSelects() {
            for (var i = 1; i <= gamePlayerCount; i++) {
                var select = document.getElementById('player' + i);
                if (select) {
                    select.innerHTML = '<option value="">ğŸ¤” è¯·é€‰æ‹©ç©å®¶</option>';
                    for (var j = 0; j < participants.length; j++) {
                        var participant = participants[j];
                        var option = document.createElement('option');
                        option.value = participant.id;
                        option.textContent = participant.name;
                        select.appendChild(option);
                    }
                }
            }
        }

        // ==================== å®‰å…¨éªŒè¯ç³»ç»Ÿ ====================
        
        /**
         * æ˜¾ç¤ºå¯†ç éªŒè¯å¯¹è¯æ¡†
         */
        function showPasswordDialog(callback, data) {
            pendingAction = callback;
            pendingActionData = data || null;
            var modal = document.getElementById('passwordModal');
            if (modal) {
                modal.style.display = 'flex';
                var passwordInput = document.getElementById('passwordInput');
                if (passwordInput) {
                    setTimeout(function() {
                        passwordInput.focus();
                    }, 100);
                }
            }
        }

        /**
         * ç¡®è®¤å¯†ç 
         */
        function confirmPassword() {
            var password = document.getElementById('passwordInput').value;
            if (password === '970508') {
                document.getElementById('passwordModal').style.display = 'none';
                document.getElementById('passwordInput').value = '';
                if (pendingAction) {
                    pendingAction(pendingActionData);
                }
                pendingAction = null;
                pendingActionData = null;
            } else {
                showAlert('ğŸš« å¯†ç é”™è¯¯ï¼Œæ— æƒé™è¿›è¡Œæ­¤æ“ä½œ', 'error');
                document.getElementById('passwordInput').value = '';
                setTimeout(function() {
                    document.getElementById('passwordInput').focus();
                }, 100);
            }
        }

        /**
         * å–æ¶ˆå¯†ç éªŒè¯
         */
        function cancelPassword() {
            document.getElementById('passwordModal').style.display = 'none';
            document.getElementById('passwordInput').value = '';
            pendingAction = null;
            pendingActionData = null;
        }

        /**
         * æ˜¾ç¤ºç¡®è®¤åˆ é™¤å¯¹è¯æ¡†
         */
        function showConfirmDialog(title, message, callback, data) {
            confirmCallback = callback;
            confirmData = data || null;
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            document.getElementById('confirmModal').style.display = 'flex';
        }

        /**
         * ç¡®è®¤åˆ é™¤æ“ä½œ
         */
        function confirmDelete() {
            document.getElementById('confirmModal').style.display = 'none';
            if (confirmCallback) {
                confirmCallback(confirmData);
            }
            confirmCallback = null;
            confirmData = null;
        }

        /**
         * å–æ¶ˆåˆ é™¤æ“ä½œ
         */
        function cancelDelete() {
            document.getElementById('confirmModal').style.display = 'none';
            confirmCallback = null;
            confirmData = null;
        }

        // ==================== æ•°æ®ç®¡ç† ====================
        
        /**
         * åˆ é™¤å‚ä¸è€…
         */
        function removeParticipant(id) {
            showConfirmDialog(
                'ğŸ—‘ï¸ åˆ é™¤å‚ä¸è€…',
                'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå‚ä¸è€…å—ï¼Ÿç›¸å…³æ¯”èµ›è®°å½•ä¹Ÿä¼šè¢«åˆ é™¤ã€‚',
                function(participantId) {
                    participants = participants.filter(function(p) { return p.id !== participantId; });
                    games = games.filter(function(game) { 
                        return !game.players.some(function(player) { return player.id == participantId; });
                    });
                    saveData();
                    updateParticipantsList();
                    updateGamePlayerSelects();
                    updateRanking();
                    updateGameHistory();
                    showAlert('âœ… å‚ä¸è€…åˆ é™¤æˆåŠŸ', 'success');
                },
                id
            );
        }
        
        /**
         * åˆ é™¤æ¯”èµ›è®°å½•
         */
        function deleteGame(gameId) {
            showConfirmDialog(
                'ğŸ—‘ï¸ åˆ é™¤æ¯”èµ›è®°å½•',
                'ç¡®å®šè¦åˆ é™¤è¿™æ¡æ¯”èµ›è®°å½•å—ï¼Ÿ',
                function(id) {
                    var game = games.find(function(g) { return g.id === id; });
                    if (game) {
                        // æ¢å¤å‚ä¸è€…ç»Ÿè®¡æ•°æ®
                        game.players.forEach(function(player) {
                            var participant = participants.find(function(p) { return p.id === player.id; });
                            if (participant) {
                                participant.totalScore -= player.score;
                                participant.gamesPlayed--;
                                if (player.score > 0) {
                                    participant.wins--;
                                }
                            }
                        });
                    }
                    games = games.filter(function(g) { return g.id !== id; });
                    saveData();
                    updateParticipantsList();
                    updateRanking();
                    updateGameHistory();
                    updateYearFilter();
                    showAlert('âœ… æ¯”èµ›è®°å½•åˆ é™¤æˆåŠŸ', 'success');
                },
                gameId
            );
        }
        
        /**
         * æ¸…ç©ºæ‰€æœ‰æ•°æ®
         */
        function clearAllData() {
            showConfirmDialog(
                'ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰æ•°æ®',
                'âš ï¸ ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼',
                function() {
                    participants = [];
                    games = [];
                    saveData();
                    updateParticipantsList();
                    updateGamePlayerSelects();
                    updateRanking();
                    updateGameHistory();
                    updateYearFilter();
                    showAlert('âœ… æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'success');
                }
            );
        }

        // ==================== é¡µé¢åŠŸèƒ½ ====================
        
        /**
         * åˆ‡æ¢åŠŸèƒ½åŒºåŸŸ
         */
        function showSection(sectionName) {
            var sections = document.querySelectorAll('.section');
            var buttons = document.querySelectorAll('.nav-btn');
            
            for (var i = 0; i < sections.length; i++) {
                sections[i].classList.remove('active');
            }
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            
            document.getElementById(sectionName).classList.add('active');
            event.target.classList.add('active');
            
            // ç‰¹å®šé¡µé¢çš„æ›´æ–°æ“ä½œ
            if (sectionName === 'ranking') {
                updateRanking();
            } else if (sectionName === 'history') {
                updateGameHistory();
            }
        }

        /**
         * æ·»åŠ å‚ä¸è€…
         */
        function addParticipant() {
            var nameInput = document.getElementById('playerName');
            var name = nameInput.value.trim();
            
            if (!name) {
                showAlert('ğŸ“ è¯·è¾“å…¥å‚ä¸è€…å§“å', 'error');
                return;
            }
            
            if (participants.find(function(p) { return p.name === name; })) {
                showAlert('âš ï¸ è¯¥å‚ä¸è€…å·²å­˜åœ¨', 'error');
                return;
            }
            
            if (participants.length >= 20) {
                showAlert('âš ï¸ å‚ä¸è€…äººæ•°ä¸èƒ½è¶…è¿‡20äºº', 'error');
                return;
            }
            
            participants.push({
                id: Date.now(),
                name: name,
                totalScore: 0,
                gamesPlayed: 0,
                wins: 0
            });
            
            nameInput.value = '';
            saveData();
            updateParticipantsList();
            updateGamePlayerSelects();
            showAlert('âœ… ' + name + ' æ·»åŠ æˆåŠŸ', 'success');
        }

        /**
         * æ›´æ–°å‚ä¸è€…åˆ—è¡¨æ˜¾ç¤º
         */
        function updateParticipantsList() {
            var container = document.getElementById('participantsList');
            container.innerHTML = '';
            
            if (participants.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 40px;">æš‚æ— å‚ä¸è€…ï¼Œè¯·å…ˆæ·»åŠ å‚ä¸è€…</div>';
                return;
            }
            
            for (var i = 0; i < participants.length; i++) {
                var participant = participants[i];
                var card = document.createElement('div');
                card.className = 'participant-card';
                card.innerHTML = 
                    '<h4>ğŸ‘¤ ' + participant.name + '</h4>' +
                    '<p>ğŸ“Š æ€»ç§¯åˆ†: <strong>' + participant.totalScore + '</strong></p>' +
                    '<p>ğŸ¯ å‚èµ›æ¬¡æ•°: <strong>' + participant.gamesPlayed + '</strong> æ¬¡</p>' +
                    '<p>ğŸ† èƒœç‡: <strong>' + (participant.gamesPlayed > 0 ? ((participant.wins / participant.gamesPlayed) * 100).toFixed(1) : '0.0') + '%</strong></p>';
                
                var deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger';
                deleteBtn.innerHTML = 'ğŸ—‘ï¸ åˆ é™¤';
                deleteBtn.onclick = (function(id) {
                    return function() {
                        showPasswordDialog(removeParticipant, id);
                    };
                })(participant.id);
                
                card.appendChild(deleteBtn);
                container.appendChild(card);
            }
        }

        /**
         * è®°å½•æ¯”èµ›ç»“æœ
         */
        function recordGame() {
            var date = document.getElementById('gameDate').value;
            if (!date) {
                showAlert('ğŸ“… è¯·é€‰æ‹©æ¯”èµ›æ—¥æœŸ', 'error');
                return;
            }
            
            var players = [];
            var scores = [];
            
            // éªŒè¯ç©å®¶é€‰æ‹©å’Œåˆ†æ•°è¾“å…¥
            for (var i = 1; i <= gamePlayerCount; i++) {
                var playerId = document.getElementById('player' + i).value;
                var scoreInput = document.getElementById('score' + i).value;
                
                if (!playerId) {
                    showAlert('ğŸ¤” è¯·é€‰æ‹©ç©å®¶ ' + i, 'error');
                    return;
                }
                
                if (!scoreInput || scoreInput.trim() === '') {
                    showAlert('ğŸ“Š è¯·è¾“å…¥ç©å®¶ ' + i + ' çš„ç§¯åˆ†', 'error');
                    return;
                }
                
                var score = parseInt(scoreInput);
                
                if (isNaN(score)) {
                    showAlert('ğŸ”¢ ç©å®¶ ' + i + ' çš„ç§¯åˆ†å¿…é¡»æ˜¯æ•´æ•°', 'error');
                    return;
                }
                
                if (score !== parseFloat(scoreInput)) {
                    showAlert('ğŸ”¢ ç©å®¶ ' + i + ' çš„ç§¯åˆ†å¿…é¡»æ˜¯æ•´æ•°', 'error');
                    return;
                }
                
                if (players.find(function(p) { return p.id == playerId; })) {
                    showAlert('âš ï¸ ä¸èƒ½é€‰æ‹©ç›¸åŒçš„ç©å®¶', 'error');
                    return;
                }
                
                var participant = participants.find(function(p) { return p.id == playerId; });
                players.push({
                    id: parseInt(playerId),
                    name: participant.name,
                    score: score
                });
                scores.push(score);
            }
            
            // éªŒè¯ç§¯åˆ†æ€»å’Œ
            var totalScore = scores.reduce(function(sum, score) { return sum + score; }, 0);
            if (totalScore !== 0) {
                showAlert('âš–ï¸ ç§¯åˆ†æ€»å’Œå¿…é¡»ä¸º0ï¼Œå½“å‰æ€»å’Œä¸º ' + totalScore, 'error');
                return;
            }
            
            // åˆ›å»ºæ¯”èµ›è®°å½•
            var game = {
                id: Date.now(),
                date: date,
                players: players
            };
            
            games.push(game);
            
            // æ›´æ–°å‚ä¸è€…ç»Ÿè®¡
            players.forEach(function(player) {
                var participant = participants.find(function(p) { return p.id === player.id; });
                participant.totalScore += player.score;
                participant.gamesPlayed++;
                if (player.score > 0) {
                    participant.wins++;
                }
            });
            
            // æ¸…ç©ºè¡¨å•
            for (var i = 1; i <= gamePlayerCount; i++) {
                document.getElementById('player' + i).value = '';
                document.getElementById('score' + i).value = '';
            }
            
            saveData();
            updateParticipantsList();
            updateYearFilter();
            showAlert('ğŸ‰ æ¯”èµ›è®°å½•æˆåŠŸï¼', 'success');
        }

        /**
         * æ›´æ–°å¹´ä»½ç­›é€‰å™¨
         */
        function updateYearFilter() {
            var yearFilter = document.getElementById('yearFilter');
            var currentOptions = Array.from(yearFilter.options).map(function(option) { return option.value; });
            
            var years = [];
            for (var i = 0; i < games.length; i++) {
                var year = new Date(games[i].date).getFullYear();
                if (years.indexOf(year) === -1) {
                    years.push(year);
                }
            }
            years.sort(function(a, b) { return b - a; });
            
            for (var i = 0; i < years.length; i++) {
                var year = years[i];
                if (currentOptions.indexOf(year.toString()) === -1) {
                    var option = document.createElement('option');
                    option.value = year;
                    option.textContent = 'ğŸ“ˆ ' + year + ' å¹´ç»Ÿè®¡';
                    yearFilter.appendChild(option);
                }
            }
        }

        /**
         * æ›´æ–°æ’åæ˜¾ç¤º
         */
        function updateRanking() {
            var selectedYear = document.getElementById('yearFilter').value;
            
            // æ ¹æ®å¹´ä»½ç­›é€‰æ¯”èµ›
            var filteredGames = games;
            if (selectedYear !== 'all') {
                filteredGames = games.filter(function(game) { 
                    return new Date(game.date).getFullYear() == selectedYear; 
                });
            }
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            document.getElementById('totalGames').textContent = filteredGames.length;
            document.getElementById('totalParticipants').textContent = participants.length;
            
            // è®¡ç®—æ’åç»Ÿè®¡
            var participantStats = {};
            for (var i = 0; i < participants.length; i++) {
                var participant = participants[i];
                participantStats[participant.id] = {
                    id: participant.id,
                    name: participant.name,
                    totalScore: 0,
                    gamesPlayed: 0,
                    wins: 0
                };
            }
            
            // ç»Ÿè®¡ç­›é€‰åçš„æ•°æ®
            for (var i = 0; i < filteredGames.length; i++) {
                var game = filteredGames[i];
                for (var j = 0; j < game.players.length; j++) {
                    var player = game.players[j];
                    if (participantStats[player.id]) {
                        participantStats[player.id].totalScore += player.score;
                        participantStats[player.id].gamesPlayed++;
                        if (player.score > 0) {
                            participantStats[player.id].wins++;
                        }
                    }
                }
            }
            
            // æ›´æ–°æ’åè¡¨æ ¼
            var tbody = document.querySelector('#rankingTable tbody');
            tbody.innerHTML = '';
            
            var sortedParticipants = Object.values(participantStats)
                .filter(function(p) { return p.gamesPlayed > 0; })
                .sort(function(a, b) { return b.totalScore - a.totalScore; });
            
            if (sortedParticipants.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #6c757d; padding: 40px;">æš‚æ— æ’åæ•°æ®</td></tr>';
                return;
            }
            
            for (var i = 0; i < sortedParticipants.length; i++) {
                var participant = sortedParticipants[i];
                var winRate = participant.gamesPlayed > 0 ? 
                    ((participant.wins / participant.gamesPlayed) * 100).toFixed(1) : '0.0';
                var avgScore = participant.gamesPlayed > 0 ? 
                    (participant.totalScore / participant.gamesPlayed).toFixed(1) : '0.0';
                
                var row = tbody.insertRow();
                var rankClass = i < 3 ? 'rank-' + (i + 1) : '';
                var rankIcon = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : (i + 1);
                
                row.innerHTML = 
                    '<td class="' + rankClass + '">' + rankIcon + '</td>' +
                    '<td>' + participant.name + '</td>' +
                    '<td><strong>' + participant.totalScore + '</strong></td>' +
                    '<td>' + participant.gamesPlayed + '</td>' +
                    '<td>' + winRate + '%</td>' +
                    '<td>' + avgScore + '</td>';
            }
        }

        /**
         * æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
         */
        function updateGameHistory() {
            var container = document.getElementById('gameHistory');
            container.innerHTML = '';
            
            if (games.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #6c757d; padding: 40px;">æš‚æ— æ¯”èµ›è®°å½•</div>';
                return;
            }
            
            var sortedGames = games.slice().sort(function(a, b) { 
                return new Date(b.date) - new Date(a.date); 
            });
            
            for (var i = 0; i < sortedGames.length; i++) {
                var game = sortedGames[i];
                var gameDiv = document.createElement('div');
                gameDiv.className = 'game-record';
                
                var playersHtml = game.players
                    .slice()
                    .sort(function(a, b) { return b.score - a.score; })
                    .map(function(player) { 
                        var scoreColor = player.score > 0 ? 'color: #28a745' : player.score < 0 ? 'color: #dc3545' : 'color: #6c757d';
                        return '<span style="' + scoreColor + '">' + player.name + ': ' + (player.score > 0 ? '+' : '') + player.score + '</span>'; 
                    })
                    .join(' | ');
                
                gameDiv.innerHTML = 
                    '<h4>ğŸ“… ' + game.date + ' (' + game.players.length + 'äººå±€)</h4>' +
                    '<p style="margin-bottom: 15px;">' + playersHtml + '</p>';
                
                var deleteBtn = document.createElement('button');
                deleteBtn.className = 'btn btn-danger';
                deleteBtn.innerHTML = 'ğŸ—‘ï¸ åˆ é™¤è®°å½•';
                deleteBtn.onclick = (function(id) {
                    return function() {
                        showPasswordDialog(deleteGame, id);
                    };
                })(game.id);
                
                gameDiv.appendChild(deleteBtn);
                container.appendChild(gameDiv);
            }
        }

        /**
         * æ•°æ®æŒä¹…åŒ– - ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
         */
        function saveData() {
            try {
                localStorage.setItem('mahjong_participants', JSON.stringify(participants));
                localStorage.setItem('mahjong_games', JSON.stringify(games));
                localStorage.setItem('mahjong_backup_time', new Date().toISOString());
            } catch (e) {
                // æœ¬åœ°å­˜å‚¨ä¸å¯ç”¨æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ
            }
        }

        /**
         * æ•°æ®åŠ è½½ - ä»æœ¬åœ°å­˜å‚¨è¯»å–
         */
        function loadData() {
            try {
                var savedParticipants = localStorage.getItem('mahjong_participants');
                var savedGames = localStorage.getItem('mahjong_games');
                
                if (savedParticipants) {
                    participants = JSON.parse(savedParticipants);
                }
                if (savedGames) {
                    games = JSON.parse(savedGames);
                }
            } catch (e) {
                // æ•°æ®è§£æå¤±è´¥æ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ
                participants = [];
                games = [];
            }
        }

        /**
         * å¯¼å‡ºæ•°æ®å¤‡ä»½
         */
        function exportData() {
            try {
                var backupData = {
                    version: '2.0',
                    exportTime: new Date().toISOString(),
                    participants: participants,
                    games: games,
                    statistics: {
                        totalParticipants: participants.length,
                        totalGames: games.length,
                        dateRange: games.length > 0 ? {
                            earliest: Math.min.apply(Math, games.map(function(g) { return new Date(g.date).getTime(); })),
                            latest: Math.max.apply(Math, games.map(function(g) { return new Date(g.date).getTime(); }))
                        } : null
                    }
                };

                var dataStr = JSON.stringify(backupData, null, 2);
                var dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                var link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = 'éº»ç¥ç†å·¥æ¯”èµ›æ•°æ®å¤‡ä»½_' + new Date().toISOString().split('T')[0] + '.json';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showAlert('ğŸ“¤ æ•°æ®å¤‡ä»½å¯¼å‡ºæˆåŠŸï¼', 'success');
            } catch (e) {
                showAlert('âŒ å¯¼å‡ºå¤±è´¥ï¼š' + e.message, 'error');
            }
        }

        /**
         * å¯¼å…¥æ•°æ®å¤‡ä»½
         */
        function importData(event) {
            var file = event.target.files[0];
            if (!file) return;

            var reader = new FileReader();
            reader.onload = function(e) {
                try {
                    var backupData = JSON.parse(e.target.result);
                    
                    // éªŒè¯æ•°æ®æ ¼å¼
                    if (!backupData.participants || !backupData.games) {
                        throw new Error('æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                    }

                    // ç¡®è®¤å¯¼å…¥
                    showConfirmDialog(
                        'ğŸ“¥ ç¡®è®¤å¯¼å…¥æ•°æ®',
                        'å¯¼å…¥å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ\n\nå¤‡ä»½ä¿¡æ¯ï¼š\nå‚ä¸è€…ï¼š' + backupData.participants.length + ' äºº\næ¯”èµ›è®°å½•ï¼š' + backupData.games.length + ' åœº\nå¯¼å‡ºæ—¶é—´ï¼š' + (backupData.exportTime ? new Date(backupData.exportTime).toLocaleString() : 'æœªçŸ¥'),
                        function() {
                            participants = backupData.participants;
                            games = backupData.games;
                            saveData();
                            updateParticipantsList();
                            updateGamePlayerSelects();
                            updateRanking();
                            updateGameHistory();
                            updateYearFilter();
                            showAlert('ğŸ“¥ æ•°æ®å¯¼å…¥æˆåŠŸï¼', 'success');
                        }
                    );
                } catch (e) {
                    showAlert('âŒ å¯¼å…¥å¤±è´¥ï¼šæ•°æ®æ ¼å¼é”™è¯¯', 'error');
                }
            };
            reader.readAsText(file);
            
            // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
            event.target.value = '';
        }

        /**
         * è‡ªåŠ¨å¤‡ä»½æ£€æŸ¥
         */
        function checkAutoBackup() {
            try {
                var lastBackup = localStorage.getItem('mahjong_backup_time');
                if (!lastBackup) return;
                
                var lastBackupTime = new Date(lastBackup);
                var daysSinceBackup = (new Date() - lastBackupTime) / (1000 * 60 * 60 * 24);
                
                if (daysSinceBackup >= 7 && (participants.length > 0 || games.length > 0)) {
                    showAlert('ğŸ’¡ æç¤ºï¼šæ•°æ®å·²è¶…è¿‡7å¤©æœªå¤‡ä»½ï¼Œå»ºè®®å¯¼å‡ºå¤‡ä»½', 'success');
                }
            } catch (e) {
                // å¿½ç•¥é”™è¯¯
            }
        }

        /**
         * æ˜¾ç¤ºæç¤ºä¿¡æ¯
         */
        function showAlert(message, type) {
            var alert = document.createElement('div');
            alert.className = 'alert alert-' + type;
            alert.textContent = message;
            
            var content = document.querySelector('.content');
            content.insertBefore(alert, content.firstChild);
            
            // è‡ªåŠ¨ç§»é™¤æç¤º
            setTimeout(function() {
                if (alert.parentNode) {
                    alert.parentNode.removeChild(alert);
                }
            }, 4000);
        }

        // ==================== é¡µé¢åˆå§‹åŒ– ====================
        
        /**
         * DOMåŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
         */
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½ä¿å­˜çš„æ•°æ®
            loadData();
            
            // åˆå§‹åŒ–å„ä¸ªæ¨¡å—
            updateParticipantsList();
            updateYearFilter();
            updateRanking();
            updateGameHistory();
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
            var dateInput = document.getElementById('gameDate');
            if (dateInput) {
                dateInput.value = new Date().toISOString().split('T')[0];
            }
            
            // ç”Ÿæˆé»˜è®¤çš„4äººæ¯”èµ›è¾“å…¥æ¡†
            generateGamePlayerInputs();
            updateGamePlayerSelects();
            
            // ç»‘å®šå¯†ç è¾“å…¥æ¡†å›è½¦äº‹ä»¶
            var passwordInput = document.getElementById('passwordInput');
            if (passwordInput) {
                passwordInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        confirmPassword();
                    }
                });
            }
            
            // ç»‘å®šæ¸…ç©ºæ•°æ®æŒ‰é’®
            var clearAllBtn = document.getElementById('clearAllBtn');
            if (clearAllBtn) {
                clearAllBtn.addEventListener('click', function() {
                    showPasswordDialog(clearAllData);
                });
            }
            
            // ç»‘å®šå‚ä¸è€…å§“åè¾“å…¥æ¡†å›è½¦äº‹ä»¶
            var playerNameInput = document.getElementById('playerName');
            if (playerNameInput) {
                playerNameInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        addParticipant();
                    }
                });
            }
            
            // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
            if (participants.length === 0 && games.length === 0) {
                showAlert('ğŸ‰ æ¬¢è¿ä½¿ç”¨éº»ç¥ç†å·¥æ¯”èµ›ç§¯åˆ†ç®¡ç†ç³»ç»Ÿï¼è¯·å…ˆæ·»åŠ å‚ä¸è€…', 'success');
            }
            
            // æ£€æŸ¥è‡ªåŠ¨å¤‡ä»½æé†’
            setTimeout(checkAutoBackup, 2000);
        });

        // ==================== é”®ç›˜å¿«æ·é”®æ”¯æŒ ====================
        document.addEventListener('keydown', function(e) {
            // ESCé”®å…³é—­å¼¹çª—
            if (e.key === 'Escape') {
                var passwordModal = document.getElementById('passwordModal');
                var confirmModal = document.getElementById('confirmModal');
                if (passwordModal.style.display === 'flex') {
                    cancelPassword();
                }
                if (confirmModal.style.display === 'flex') {
                    cancelDelete();
                }
            }
        });

        // ==================== ç§»åŠ¨ç«¯ä¼˜åŒ– ====================
        
        /**
         * æ£€æµ‹æ˜¯å¦ä¸ºè§¦æ‘¸è®¾å¤‡
         */
        function isTouchDevice() {
            return ('ontouchstart' in window) || 
                   (navigator.maxTouchPoints > 0) || 
                   (navigator.msMaxTouchPoints > 0);
        }

        /**
         * ä¼˜åŒ–ç§»åŠ¨ç«¯æ»šåŠ¨æ€§èƒ½
         */
        if (isTouchDevice()) {
            document.addEventListener('touchmove', function(e) {
                // å…è®¸æ»šåŠ¨
            }, { passive: true });
        }

        /**
         * é˜²æ­¢iOSæ©¡çš®ç­‹æ•ˆæœ
         */
        document.body.addEventListener('touchmove', function(e) {
            if (e.target.closest('.nav') || e.target.closest('.table-wrapper')) {
                // å…è®¸å¯¼èˆªæ å’Œè¡¨æ ¼æ»šåŠ¨
                return;
            }
            if (document.body.scrollHeight <= window.innerHeight) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>